<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TaxMate Malaysia 2025 - Professional Tax Calculator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    :root {
      --primary-color: #2563eb;
      --primary-dark: #1e40af;
      --primary-light: #3b82f6;
      --primary-glow: rgba(37, 99, 235, 0.2);
      --secondary-color: #64748b;
      --success-color: #10b981;
      --success-light: #d1fae5;
      --warning-color: #f59e0b;
      --warning-light: #fef3c7;
      --error-color: #ef4444;
      --error-light: #fee2e2;
      --background-color: #f8fafc;
      --surface-color: #ffffff;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --text-muted: #94a3b8;
      --border-color: #e2e8f0;
      --border-hover: #cbd5e1;
      --border-focus: var(--primary-color);
      --border-radius: 12px;
      --border-radius-lg: 16px;
      --border-radius-xl: 24px;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
      --shadow-glow: 0 0 20px rgba(37, 99, 235, 0.15);
      --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
      --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-slow: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      --spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #667eea 100%);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
      min-height: 100vh;
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .app-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      position: relative;
    }

    .app-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at 20% 80%, rgba(37, 99, 235, 0.1) 0%, transparent 50%),
                  radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
      pointer-events: none;
    }

    .main-container {
      background: var(--surface-color);
      border-radius: var(--border-radius-xl);
      box-shadow: var(--shadow-xl), var(--shadow-glow);
      overflow: hidden;
      max-width: 1200px;
      width: 100%;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0;
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      animation: containerSlideUp 0.8s var(--spring);
      z-index: 1;
    }

    @keyframes containerSlideUp {
      from {
        opacity: 0;
        transform: translateY(40px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .calculator-section {
      padding: 48px;
      position: relative;
      overflow: hidden;
    }

    .calculator-section::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(37, 99, 235, 0.03) 0%, transparent 70%);
      pointer-events: none;
    }

    .results-section {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      background-size: 200% 200%;
      animation: gradientFloat 8s ease-in-out infinite;
      color: white;
      padding: 48px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .results-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.05) 50%, transparent 70%);
      transform: translateX(-100%);
      animation: shimmer 3s infinite;
    }

    @keyframes gradientFloat {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      animation: headerFadeIn 1s ease-out 0.3s both;
    }

    @keyframes headerFadeIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      position: relative;
    }

    .header h1::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
      border-radius: 2px;
      animation: underlineGrow 0.8s ease-out 0.8s both;
    }

    @keyframes underlineGrow {
      from {
        width: 0;
        opacity: 0;
      }
      to {
        width: 60px;
        opacity: 1;
      }
    }

    .header .subtitle {
      color: var(--text-secondary);
      font-size: 1.1rem;
      font-weight: 400;
      opacity: 0;
      animation: subtitleFadeIn 0.6s ease-out 1s both;
    }

    @keyframes subtitleFadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .form-group {
      margin-bottom: 24px;
      opacity: 0;
      animation: formGroupSlideIn 0.5s ease-out both;
    }

    .form-group:nth-child(1) { animation-delay: 0.2s; }
    .form-group:nth-child(2) { animation-delay: 0.3s; }
    .form-group:nth-child(3) { animation-delay: 0.4s; }

    @keyframes formGroupSlideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    label {
      display: flex;
      align-items: center;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 8px;
      font-size: 0.95rem;
      transition: var(--transition);
      cursor: pointer;
    }

    label:hover {
      color: var(--primary-color);
    }

    label i {
      margin-right: 8px;
      color: var(--primary-color);
      width: 16px;
      transition: var(--transition);
    }

    label:hover i {
      transform: scale(1.1);
      color: var(--primary-dark);
    }

    .tooltip {
      position: relative;
      margin-left: 8px;
      cursor: help;
      transition: var(--transition);
    }

    .tooltip:hover {
      transform: scale(1.1);
    }

    .tooltip i {
      color: var(--text-secondary);
      font-size: 0.875rem;
      transition: var(--transition);
    }

    .tooltip:hover i {
      color: var(--primary-color);
    }

    .tooltip .tooltip-text {
      visibility: hidden;
      width: 280px;
      background: linear-gradient(135deg, var(--text-primary) 0%, #334155 100%);
      color: white;
      text-align: left;
      border-radius: var(--border-radius);
      padding: 16px;
      position: absolute;
      z-index: 1000;
      bottom: 140%;
      left: 50%;
      margin-left: -140px;
      opacity: 0;
      transform: translateY(10px) scale(0.9);
      transition: var(--transition-slow);
      font-size: 0.875rem;
      font-weight: 400;
      line-height: 1.5;
      box-shadow: var(--shadow-lg);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .tooltip .tooltip-text::before {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      margin-left: -8px;
      border: 8px solid transparent;
      border-top-color: var(--text-primary);
    }

    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    .input-container {
      position: relative;
      transition: var(--transition);
    }

    .input-container:hover {
      transform: translateY(-1px);
    }

    input[type="number"] {
      width: 100%;
      padding: 16px 48px 16px 16px;
      border: 2px solid var(--border-color);
      border-radius: var(--border-radius);
      font-size: 1rem;
      transition: var(--transition);
      background: var(--surface-color);
      font-family: inherit;
      position: relative;
    }

    input[type="number"]:hover {
      border-color: var(--border-hover);
      box-shadow: var(--shadow-sm);
    }

    input[type="number"]:focus {
      outline: none;
      border-color: var(--border-focus);
      box-shadow: 0 0 0 4px var(--primary-glow), var(--shadow-md);
      transform: translateY(-1px);
    }

    input[type="number"]:valid {
      border-color: var(--success-color);
    }

    input[type="number"].error {
      border-color: var(--error-color);
      background-color: var(--error-light);
      animation: inputShake 0.5s ease-in-out;
    }

    @keyframes inputShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-4px); }
      75% { transform: translateX(4px); }
    }

    .currency-symbol {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      font-weight: 600;
      pointer-events: none;
      transition: var(--transition);
      font-size: 0.9rem;
    }

    input[type="number"]:focus + .currency-symbol {
      color: var(--primary-color);
      transform: translateY(-50%) scale(1.05);
    }

    .advanced-options {
      margin-top: 32px;
      border-top: 2px solid var(--border-color);
      padding-top: 32px;
      opacity: 0;
      animation: advancedSlideIn 0.6s ease-out 0.8s both;
    }

    @keyframes advancedSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .advanced-toggle {
      display: flex;
      align-items: center;
      cursor: pointer;
      color: var(--primary-color);
      font-weight: 500;
      margin-bottom: 24px;
      transition: var(--transition);
      padding: 8px 0;
      border-radius: var(--border-radius);
      position: relative;
      overflow: hidden;
    }

    .advanced-toggle::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(37, 99, 235, 0.1), transparent);
      transition: left 0.5s ease;
    }

    .advanced-toggle:hover::before {
      left: 100%;
    }

    .advanced-toggle:hover {
      color: var(--primary-dark);
      transform: translateX(4px);
    }

    .advanced-toggle i {
      margin-left: 8px;
      transition: var(--transition-slow);
    }

    .advanced-content {
      display: none;
      opacity: 0;
      max-height: 0;
      overflow: hidden;
      transition: var(--transition-slow);
    }

    .advanced-content.show {
      display: block;
      opacity: 1;
      max-height: 800px;
      animation: advancedContentSlide 0.5s var(--spring);
    }

    @keyframes advancedContentSlide {
      from {
        opacity: 0;
        transform: translateY(-20px);
        max-height: 0;
      }
      to {
        opacity: 1;
        transform: translateY(0);
        max-height: 800px;
      }
    }

    .relief-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .relief-grid .form-group {
      animation: reliefItemSlide 0.4s ease-out both;
    }

    .relief-grid .form-group:nth-child(1) { animation-delay: 0.1s; }
    .relief-grid .form-group:nth-child(2) { animation-delay: 0.2s; }
    .relief-grid .form-group:nth-child(3) { animation-delay: 0.3s; }
    .relief-grid .form-group:nth-child(4) { animation-delay: 0.4s; }

    @keyframes reliefItemSlide {
      from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .calculate-btn {
      width: 100%;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
      color: white;
      border: none;
      padding: 18px 24px;
      border-radius: var(--border-radius);
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      margin-top: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      position: relative;
      overflow: hidden;
      opacity: 0;
      animation: buttonSlideUp 0.6s ease-out 1.2s both;
    }

    @keyframes buttonSlideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .calculate-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }

    .calculate-btn:hover::before {
      left: 100%;
    }

    .calculate-btn:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-xl), 0 8px 25px rgba(37, 99, 235, 0.3);
    }

    .calculate-btn:active {
      transform: translateY(-1px);
    }

    .calculate-btn.loading {
      opacity: 0.9;
      cursor: not-allowed;
      transform: none;
    }

    .calculate-btn.loading:hover {
      transform: none;
      box-shadow: var(--shadow-lg);
    }

    .spinner {
      width: 24px;
      height: 24px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    .progress-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      background: linear-gradient(90deg, #10b981, #3b82f6, #8b5cf6);
      border-radius: 3px;
      transform: scaleX(0);
      transform-origin: left;
      animation: progressFill 2s ease-in-out infinite;
    }

    @keyframes progressFill {
      0% { transform: scaleX(0); }
      50% { transform: scaleX(0.7); }
      100% { transform: scaleX(1); }
    }

    .results-container {
      opacity: 0;
      transform: translateY(30px);
      transition: var(--transition-slow);
    }

    .results-container.show {
      opacity: 1;
      transform: translateY(0);
    }

    .result-card {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--border-radius-lg);
      padding: 24px;
      margin-bottom: 24px;
      backdrop-filter: blur(20px);
      transition: var(--transition);
      opacity: 0;
      transform: translateX(-20px);
      animation: resultCardSlide 0.6s ease-out both;
    }

    .result-card:nth-child(1) { animation-delay: 0.1s; }
    .result-card:nth-child(2) { animation-delay: 0.2s; }
    .result-card:nth-child(3) { animation-delay: 0.3s; }

    @keyframes resultCardSlide {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .result-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      background: rgba(255, 255, 255, 0.15);
    }

    .result-header {
      display: flex;
      align-items: center;
      margin-bottom: 16px;
    }

    .result-header h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-left: 12px;
    }

    .result-amount {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 8px;
      background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: amountPulse 2s ease-in-out infinite;
    }

    @keyframes amountPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }

    .result-label {
      opacity: 0.9;
      font-size: 0.95rem;
      font-weight: 500;
    }

    .breakdown-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      transition: var(--transition);
      opacity: 0;
      animation: breakdownSlide 0.4s ease-out both;
    }

    .breakdown-item:nth-child(1) { animation-delay: 0.1s; }
    .breakdown-item:nth-child(2) { animation-delay: 0.2s; }
    .breakdown-item:nth-child(3) { animation-delay: 0.3s; }
    .breakdown-item:nth-child(4) { animation-delay: 0.4s; }

    @keyframes breakdownSlide {
      from {
        opacity: 0;
        transform: translateX(-10px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .breakdown-item:hover {
      background: rgba(255, 255, 255, 0.05);
      padding-left: 8px;
      border-radius: 6px;
    }

    .breakdown-item:last-child {
      border-bottom: none;
    }

    .breakdown-label {
      opacity: 0.9;
      transition: var(--transition);
    }

    .breakdown-value {
      font-weight: 600;
      transition: var(--transition);
    }

    .breakdown-item:hover .breakdown-label,
    .breakdown-item:hover .breakdown-value {
      opacity: 1;
      transform: translateX(4px);
    }

    .tax-brackets {
      margin-top: 24px;
    }

    .bracket-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      margin: 4px 0;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      font-size: 0.9rem;
    }

    .bracket-rate {
      font-weight: 600;
      color: #fbbf24;
    }

    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 32px;
    }

    .btn-secondary {
      flex: 1;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 12px 16px;
      border-radius: var(--border-radius);
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        max-height: 0;
      }
      to {
        opacity: 1;
        max-height: 1000px;
      }
    }

    @media (max-width: 768px) {
      .main-container {
        grid-template-columns: 1fr;
        max-width: 500px;
        margin: 10px;
        border-radius: var(--border-radius-lg);
      }
      
      .calculator-section,
      .results-section {
        padding: 24px 20px;
      }
      
      .header h1 {
        font-size: 2rem;
      }

      .header .subtitle {
        font-size: 1rem;
      }
      
      .relief-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      
      .result-amount {
        font-size: 2rem;
      }

      .tooltip .tooltip-text {
        width: 250px;
        margin-left: -125px;
        font-size: 0.8rem;
        bottom: 120%;
      }

      .calculate-btn {
        padding: 16px 20px;
        font-size: 1rem;
      }

      .action-buttons {
        flex-direction: column;
        gap: 8px;
      }

      .btn-secondary {
        padding: 14px 16px;
      }

      /* Enhanced mobile touch targets */
      input[type="number"] {
        padding: 18px 48px 18px 16px;
        font-size: 16px; /* Prevent zoom on iOS */
      }

      label {
        font-size: 1rem;
        margin-bottom: 10px;
      }

      .advanced-toggle {
        padding: 12px 8px;
        font-size: 1rem;
      }
    }

    @media (max-width: 480px) {
      .app-container {
        padding: 10px;
      }

      .calculator-section,
      .results-section {
        padding: 20px 16px;
      }

      .header h1 {
        font-size: 1.75rem;
      }

      .result-amount {
        font-size: 1.75rem;
      }

      .breakdown-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
        padding: 16px 0;
      }

      .bracket-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
        padding: 12px;
      }
    }

    /* High contrast mode support */
    @media (prefers-contrast: high) {
      :root {
        --border-color: #000000;
        --text-secondary: #000000;
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.3), 0 2px 4px -2px rgb(0 0 0 / 0.3);
      }
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      :root {
        --surface-color: #1e293b;
        --text-primary: #f1f5f9;
        --text-secondary: #94a3b8;
        --border-color: #334155;
        --background-color: #0f172a;
      }

      .main-container {
        background: var(--surface-color);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      input[type="number"] {
        background: #334155;
        color: var(--text-primary);
        border-color: #475569;
      }

      input[type="number"]:focus {
        background: #475569;
      }
    }

    .error-message {
      color: var(--error-color);
      font-size: 0.875rem;
      margin-top: 8px;
      display: none;
      padding: 8px 12px;
      background: var(--error-light);
      border-radius: var(--border-radius);
      border-left: 3px solid var(--error-color);
      animation: errorSlideIn 0.3s ease-out;
    }

    @keyframes errorSlideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
        max-height: 0;
      }
      to {
        opacity: 1;
        transform: translateY(0);
        max-height: 50px;
      }
    }

    .success-message {
      color: var(--success-color);
      font-size: 0.875rem;
      margin-top: 8px;
      display: none;
      padding: 8px 12px;
      background: var(--success-light);
      border-radius: var(--border-radius);
      border-left: 3px solid var(--success-color);
      animation: successSlideIn 0.3s ease-out;
    }

    @keyframes successSlideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
        max-height: 0;
      }
      to {
        opacity: 1;
        transform: translateY(0);
        max-height: 50px;
      }
    }

    .success-animation {
      animation: successPulse 0.8s ease-in-out;
    }

    @keyframes successPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }

    /* Loading overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      backdrop-filter: blur(5px);
    }

    .loading-overlay.show {
      display: flex;
    }

    .loading-content {
      background: white;
      padding: 40px;
      border-radius: var(--border-radius-lg);
      text-align: center;
      box-shadow: var(--shadow-xl);
      animation: loadingBounce 0.5s ease-out;
    }

    @keyframes loadingBounce {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="main-container">
      <!-- Calculator Section -->
      <div class="calculator-section">
        <div class="header">
          <h1>TaxMate Malaysia</h1>
          <p class="subtitle">Professional Tax Calculator 2025</p>
        </div>

        <form id="taxForm">
          <div class="form-group">
            <label for="income">
              <i class="fas fa-money-bill-wave"></i>
              Annual Gross Income
              <span class="tooltip">
                <i class="fas fa-info-circle"></i>
                <span class="tooltip-text">Your total yearly income before any deductions including salary, bonuses, and allowances.</span>
              </span>
            </label>
            <div class="input-container">
              <input type="number" id="income" placeholder="e.g., 60000" min="0" step="100" required />
              <span class="currency-symbol">RM</span>
            </div>
            <div class="error-message" id="income-error"></div>
            <div class="success-message" id="income-success">✓ Valid income amount</div>
          </div>

          <div class="form-group">
            <label for="epf">
              <i class="fas fa-piggy-bank"></i>
              EPF Contribution
              <span class="tooltip">
                <i class="fas fa-info-circle"></i>
                <span class="tooltip-text">Maximum claimable EPF contribution is RM 4,000 per year.</span>
              </span>
            </label>
            <div class="input-container">
              <input type="number" id="epf" placeholder="Maximum: 4000" min="0" max="4000" step="100" />
              <span class="currency-symbol">RM</span>
            </div>
            <div class="error-message" id="epf-error"></div>
            <div class="success-message" id="epf-success">✓ Valid EPF contribution</div>
          </div>

          <div class="advanced-options">
            <div class="advanced-toggle" onclick="toggleAdvanced()">
              <span>Advanced Tax Relief Options</span>
              <i class="fas fa-chevron-down" id="advancedIcon"></i>
            </div>
            
            <div class="advanced-content" id="advancedContent">
              <div class="relief-grid">
                <div class="form-group">
                  <label for="medical">
                    <i class="fas fa-hospital"></i>
                    Medical Expenses
                  </label>
                  <div class="input-container">
                    <input type="number" id="medical" placeholder="Max: 8000" min="0" max="8000" step="100" />
                    <span class="currency-symbol">RM</span>
                  </div>
                </div>

                <div class="form-group">
                  <label for="education">
                    <i class="fas fa-graduation-cap"></i>
                    Education Fees
                  </label>
                  <div class="input-container">
                    <input type="number" id="education" placeholder="Max: 7000" min="0" max="7000" step="100" />
                    <span class="currency-symbol">RM</span>
                  </div>
                </div>

                <div class="form-group">
                  <label for="insurance">
                    <i class="fas fa-shield-alt"></i>
                    Life Insurance
                  </label>
                  <div class="input-container">
                    <input type="number" id="insurance" placeholder="Max: 3000" min="0" max="3000" step="100" />
                    <span class="currency-symbol">RM</span>
                  </div>
                </div>

                <div class="form-group">
                  <label for="donation">
                    <i class="fas fa-heart"></i>
                    Donations
                  </label>
                  <div class="input-container">
                    <input type="number" id="donation" placeholder="Max: 10000" min="0" max="10000" step="100" />
                    <span class="currency-symbol">RM</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <button type="submit" class="calculate-btn" id="calculateBtn">
            <i class="fas fa-calculator"></i>
            <span id="btnText">Calculate Tax</span>
            <div class="spinner" id="spinner" style="display: none;"></div>
          </button>
        </form>
      </div>

      <!-- Results Section -->
      <div class="results-section">
        <div class="results-container" id="resultsContainer">
          <div class="result-card">
            <div class="result-header">
              <i class="fas fa-file-invoice-dollar fa-2x"></i>
              <h3>Tax Summary</h3>
            </div>
            <div class="result-amount" id="totalTax">RM 0.00</div>
            <div class="result-label">Total Tax Payable</div>
          </div>

          <div class="result-card">
            <div class="result-header">
              <i class="fas fa-chart-line fa-lg"></i>
              <h3>Income Breakdown</h3>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Gross Income</span>
              <span class="breakdown-value" id="grossIncome">RM 0.00</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Total Relief</span>
              <span class="breakdown-value" id="totalRelief">RM 0.00</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Chargeable Income</span>
              <span class="breakdown-value" id="chargeableIncome">RM 0.00</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Effective Tax Rate</span>
              <span class="breakdown-value" id="effectiveRate">0.00%</span>
            </div>
          </div>

          <div class="result-card">
            <div class="result-header">
              <i class="fas fa-layer-group fa-lg"></i>
              <h3>Tax Brackets Applied</h3>
            </div>
            <div id="taxBrackets"></div>
          </div>

          <div class="action-buttons">
            <button class="btn-secondary" onclick="exportPDF()">
              <i class="fas fa-file-pdf"></i>
              Export PDF
            </button>
            <button class="btn-secondary" onclick="saveCalculation()">
              <i class="fas fa-save"></i>
              Save Result
            </button>
            <button class="btn-secondary" onclick="shareResult()">
              <i class="fas fa-share-alt"></i>
              Share
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Tax calculation data and utilities
    const TAX_BRACKETS = [
      { limit: 5000, rate: 0, label: "First RM 5,000" },
      { limit: 20000, rate: 0.01, label: "RM 5,001 - RM 20,000" },
      { limit: 35000, rate: 0.03, label: "RM 20,001 - RM 35,000" },
      { limit: 50000, rate: 0.06, label: "RM 35,001 - RM 50,000" },
      { limit: 70000, rate: 0.11, label: "RM 50,001 - RM 70,000" },
      { limit: 100000, rate: 0.19, label: "RM 70,001 - RM 100,000" },
      { limit: 400000, rate: 0.25, label: "RM 100,001 - RM 400,000" },
      { limit: 600000, rate: 0.26, label: "RM 400,001 - RM 600,000" },
      { limit: 2000000, rate: 0.28, label: "RM 600,001 - RM 2,000,000" },
      { limit: Infinity, rate: 0.30, label: "Above RM 2,000,000" }
    ];

    const RELIEF_LIMITS = {
      personal: 9000,
      socso: 250,
      lifestyle: 2500,
      epf: 4000,
      medical: 8000,
      education: 7000,
      insurance: 3000,
      donation: 10000
    };

    let calculationHistory = JSON.parse(localStorage.getItem('taxCalculations') || '[]');

    // Form validation with enhanced UX
    function validateInput(input, min = 0, max = Infinity) {
      const value = parseFloat(input.value) || 0;
      const errorElement = document.getElementById(`${input.id}-error`);
      const successElement = document.getElementById(`${input.id}-success`);
      
      // Remove previous states
      input.classList.remove('error');
      if (errorElement) errorElement.style.display = 'none';
      if (successElement) successElement.style.display = 'none';
      
      if (input.value && (value < min || value > max)) {
        input.classList.add('error');
        if (errorElement) {
          errorElement.textContent = `Value must be between ${formatCurrency(min)} and ${formatCurrency(max)}`;
          errorElement.style.display = 'block';
        }
        return false;
      }
      
      if (input.value && value >= min && value <= max) {
        if (successElement) {
          successElement.style.display = 'block';
        }
      }
      
      return true;
    }

    // Enhanced number formatting
    function formatCurrency(amount) {
      return `RM ${amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
    }

    function formatNumber(num) {
      return num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    // Enhanced advanced options toggle
    function toggleAdvanced() {
      const content = document.getElementById('advancedContent');
      const icon = document.getElementById('advancedIcon');
      const toggle = document.querySelector('.advanced-toggle');
      
      if (content.classList.contains('show')) {
        content.classList.remove('show');
        icon.style.transform = 'rotate(0deg)';
        toggle.style.color = 'var(--primary-color)';
        
        // Animate out the form groups
        const formGroups = content.querySelectorAll('.form-group');
        formGroups.forEach((group, index) => {
          setTimeout(() => {
            group.style.animation = 'reliefItemSlideOut 0.3s ease-in both';
          }, index * 50);
        });
      } else {
        content.classList.add('show');
        icon.style.transform = 'rotate(180deg)';
        toggle.style.color = 'var(--primary-dark)';
        
        // Trigger animation for form groups
        setTimeout(() => {
          const formGroups = content.querySelectorAll('.form-group');
          formGroups.forEach((group, index) => {
            group.style.animation = `reliefItemSlide 0.4s ease-out ${0.1 + (index * 0.1)}s both`;
          });
        }, 100);
      }
    }

    // Add slide out animation
    const styleSheet = document.createElement('style');
    styleSheet.textContent = `
      @keyframes reliefItemSlideOut {
        from {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
        to {
          opacity: 0;
          transform: translateY(-20px) scale(0.95);
        }
      }
    `;
    document.head.appendChild(styleSheet);

    // Tax calculation engine
    function calculateTaxBreakdown(chargeableIncome) {
      let tax = 0;
      let previousLimit = 0;
      const appliedBrackets = [];

      for (const bracket of TAX_BRACKETS) {
        if (chargeableIncome > previousLimit) {
          const taxableAmount = Math.min(chargeableIncome, bracket.limit) - previousLimit;
          const taxForBracket = taxableAmount * bracket.rate;
          
          if (taxableAmount > 0) {
            appliedBrackets.push({
              ...bracket,
              taxableAmount,
              taxForBracket
            });
            tax += taxForBracket;
          }
          
          previousLimit = bracket.limit;
        } else {
          break;
        }
      }

      return { tax, appliedBrackets };
    }

    // Main calculation function
    function calculateTax() {
      // Get all input values
      const income = parseFloat(document.getElementById('income').value) || 0;
      const epf = Math.min(parseFloat(document.getElementById('epf').value) || 0, RELIEF_LIMITS.epf);
      const medical = Math.min(parseFloat(document.getElementById('medical').value) || 0, RELIEF_LIMITS.medical);
      const education = Math.min(parseFloat(document.getElementById('education').value) || 0, RELIEF_LIMITS.education);
      const insurance = Math.min(parseFloat(document.getElementById('insurance').value) || 0, RELIEF_LIMITS.insurance);
      const donation = Math.min(parseFloat(document.getElementById('donation').value) || 0, RELIEF_LIMITS.donation);

      // Validate income
      if (income <= 0) {
        showError('Please enter a valid income amount');
        return;
      }

      // Show loading state
      showLoading(true);

      // Simulate calculation delay for better UX
      setTimeout(() => {
        // Calculate reliefs
        const personalRelief = RELIEF_LIMITS.personal;
        const socsoRelief = RELIEF_LIMITS.socso;
        const lifestyleRelief = RELIEF_LIMITS.lifestyle;

        const totalRelief = personalRelief + socsoRelief + lifestyleRelief + epf + medical + education + insurance + donation;
        const chargeableIncome = Math.max(income - totalRelief, 0);

        // Calculate tax
        const { tax, appliedBrackets } = calculateTaxBreakdown(chargeableIncome);
        const effectiveRate = income > 0 ? (tax / income) * 100 : 0;

        // Display results
        displayResults({
          income,
          totalRelief,
          chargeableIncome,
          tax,
          effectiveRate,
          appliedBrackets
        });

        // Save to history
        saveToHistory({
          date: new Date().toISOString(),
          income,
          totalRelief,
          chargeableIncome,
          tax,
          effectiveRate
        });

        showLoading(false);
      }, 800);
    }

    // Enhanced display results with better animations
    function displayResults(results) {
      const { income, totalRelief, chargeableIncome, tax, effectiveRate, appliedBrackets } = results;

      // Update main results with animations
      const totalTaxElement = document.getElementById('totalTax');
      const elements = {
        totalTax: tax,
        grossIncome: income,
        totalRelief: totalRelief,
        chargeableIncome: chargeableIncome,
        effectiveRate: effectiveRate
      };

      // Animate numbers counting up
      Object.entries(elements).forEach(([id, value]) => {
        const element = document.getElementById(id);
        if (id === 'effectiveRate') {
          animateNumber(element, 0, value, '%', 1000);
        } else {
          animateNumber(element, 0, value, 'RM', 1200);
        }
      });

      // Update tax brackets with staggered animation
      const bracketsContainer = document.getElementById('taxBrackets');
      bracketsContainer.innerHTML = '';

      appliedBrackets.forEach((bracket, index) => {
        const bracketElement = document.createElement('div');
        bracketElement.className = 'bracket-item';
        bracketElement.style.opacity = '0';
        bracketElement.style.transform = 'translateX(-20px)';
        bracketElement.innerHTML = `
          <span>${bracket.label}</span>
          <span class="bracket-rate">${(bracket.rate * 100).toFixed(0)}% - ${formatCurrency(bracket.taxForBracket)}</span>
        `;
        bracketsContainer.appendChild(bracketElement);

        // Animate in with delay
        setTimeout(() => {
          bracketElement.style.transition = 'all 0.4s ease-out';
          bracketElement.style.opacity = '1';
          bracketElement.style.transform = 'translateX(0)';
        }, 100 + (index * 100));
      });

      // Show results with enhanced animation
      const resultsContainer = document.getElementById('resultsContainer');
      resultsContainer.classList.add('show');
      resultsContainer.classList.add('success-animation');
      
      // Add confetti effect for large tax savings
      if (totalRelief > 10000) {
        createConfetti();
      }
      
      setTimeout(() => {
        resultsContainer.classList.remove('success-animation');
      }, 800);
    }

    // Number animation function
    function animateNumber(element, start, end, prefix = '', duration = 1000) {
      const startTime = Date.now();
      const range = end - start;

      function updateNumber() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        // Use easing function for smooth animation
        const easeOutQuart = 1 - Math.pow(1 - progress, 4);
        const current = start + (range * easeOutQuart);

        if (prefix === '%') {
          element.textContent = `${current.toFixed(2)}%`;
        } else {
          element.textContent = `${prefix} ${formatNumber(current)}`;
        }

        if (progress < 1) {
          requestAnimationFrame(updateNumber);
        }
      }

      updateNumber();
    }

    // Confetti effect for celebrations
    function createConfetti() {
      const colors = ['#2563eb', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];
      const confettiCount = 50;

      for (let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement('div');
        confetti.style.position = 'fixed';
        confetti.style.width = '8px';
        confetti.style.height = '8px';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.top = '-10px';
        confetti.style.zIndex = '10000';
        confetti.style.borderRadius = '50%';
        confetti.style.pointerEvents = 'none';
        
        document.body.appendChild(confetti);

        const animation = confetti.animate([
          { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
          { transform: `translateY(100vh) rotate(720deg)`, opacity: 0 }
        ], {
          duration: 3000 + Math.random() * 2000,
          easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
        });

        animation.onfinish = () => confetti.remove();
      }
    }

    // Enhanced loading state management
    function showLoading(isLoading) {
      const btn = document.getElementById('calculateBtn');
      const btnText = document.getElementById('btnText');
      const spinner = document.getElementById('spinner');

      if (isLoading) {
        btn.classList.add('loading');
        btnText.textContent = 'Calculating...';
        spinner.style.display = 'block';
        
        // Add progress bar
        const progressBar = document.createElement('div');
        progressBar.className = 'progress-bar';
        progressBar.id = 'progressBar';
        btn.appendChild(progressBar);
        
        // Create loading overlay
        showLoadingOverlay(true);
      } else {
        btn.classList.remove('loading');
        btnText.textContent = 'Calculate Tax';
        spinner.style.display = 'none';
        
        // Remove progress bar
        const progressBar = document.getElementById('progressBar');
        if (progressBar) progressBar.remove();
        
        // Remove loading overlay
        showLoadingOverlay(false);
      }
    }

    function showLoadingOverlay(show) {
      let overlay = document.getElementById('loadingOverlay');
      
      if (show) {
        if (!overlay) {
          overlay = document.createElement('div');
          overlay.id = 'loadingOverlay';
          overlay.className = 'loading-overlay';
          overlay.innerHTML = `
            <div class="loading-content">
              <div class="spinner" style="display: block; margin: 0 auto 20px;"></div>
              <h3 style="margin: 0 0 10px; color: var(--text-primary);">Calculating Your Tax</h3>
              <p style="margin: 0; color: var(--text-secondary);">Processing your information...</p>
            </div>
          `;
          document.body.appendChild(overlay);
        }
        overlay.classList.add('show');
      } else {
        if (overlay) {
          overlay.classList.remove('show');
          setTimeout(() => overlay.remove(), 300);
        }
      }
    }

    // Error handling
    function showError(message) {
      alert(message); // In a production app, use a proper toast/notification system
    }

    // History management
    function saveToHistory(calculation) {
      calculationHistory.unshift(calculation);
      if (calculationHistory.length > 10) {
        calculationHistory = calculationHistory.slice(0, 10);
      }
      localStorage.setItem('taxCalculations', JSON.stringify(calculationHistory));
    }

    // Export functionality
    function exportPDF() {
      // In a real application, you would use a library like jsPDF
      const results = {
        income: document.getElementById('grossIncome').textContent,
        relief: document.getElementById('totalRelief').textContent,
        chargeable: document.getElementById('chargeableIncome').textContent,
        tax: document.getElementById('totalTax').textContent,
        rate: document.getElementById('effectiveRate').textContent
      };

      const printContent = `
        <div style="font-family: Arial, sans-serif; padding: 20px;">
          <h1 style="color: #2563eb;">TaxMate Malaysia 2025 - Tax Calculation Report</h1>
          <p><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
          <hr>
          <h2>Tax Summary</h2>
          <p><strong>Gross Income:</strong> ${results.income}</p>
          <p><strong>Total Relief:</strong> ${results.relief}</p>
          <p><strong>Chargeable Income:</strong> ${results.chargeable}</p>
          <p><strong>Total Tax Payable:</strong> ${results.tax}</p>
          <p><strong>Effective Tax Rate:</strong> ${results.rate}</p>
        </div>
      `;

      const printWindow = window.open('', '_blank');
      printWindow.document.write(printContent);
      printWindow.document.close();
      printWindow.print();
    }

    function saveCalculation() {
      const results = {
        date: new Date().toLocaleDateString(),
        income: document.getElementById('grossIncome').textContent,
        tax: document.getElementById('totalTax').textContent
      };
      
      alert(`Calculation saved! Total tax: ${results.tax}`);
    }

    function shareResult() {
      const tax = document.getElementById('totalTax').textContent;
      const income = document.getElementById('grossIncome').textContent;
      
      if (navigator.share) {
        navigator.share({
          title: 'My Tax Calculation - TaxMate Malaysia',
          text: `My estimated tax for ${income} annual income is ${tax}`,
          url: window.location.href
        });
      } else {
        const shareText = `My estimated tax for ${income} annual income is ${tax}. Calculated using TaxMate Malaysia 2025.`;
        navigator.clipboard.writeText(shareText).then(() => {
          alert('Tax calculation copied to clipboard!');
        });
      }
    }

    // Form submission handler
    document.getElementById('taxForm').addEventListener('submit', function(e) {
      e.preventDefault();
      calculateTax();
    });

    // Enhanced input validation on blur and input
    document.addEventListener('DOMContentLoaded', function() {
      const inputs = document.querySelectorAll('input[type="number"]');
      
      inputs.forEach(input => {
        // Real-time validation on input
        input.addEventListener('input', function() {
          let value = this.value.replace(/[^\d.]/g, '');
          if (value.split('.').length > 2) {
            value = value.substring(0, value.lastIndexOf('.'));
          }
          this.value = value;
          
          // Debounced validation
          clearTimeout(this.validationTimeout);
          this.validationTimeout = setTimeout(() => {
            const max = parseFloat(this.getAttribute('max')) || Infinity;
            const min = parseFloat(this.getAttribute('min')) || 0;
            validateInput(this, min, max);
          }, 300);
        });

        // Validation on blur
        input.addEventListener('blur', function() {
          const max = parseFloat(this.getAttribute('max')) || Infinity;
          const min = parseFloat(this.getAttribute('min')) || 0;
          validateInput(this, min, max);
        });

        // Enhanced focus effects
        input.addEventListener('focus', function() {
          this.parentElement.style.transform = 'translateY(-2px)';
          this.parentElement.style.boxShadow = 'var(--shadow-md)';
        });

        input.addEventListener('blur', function() {
          this.parentElement.style.transform = 'translateY(0)';
          this.parentElement.style.boxShadow = 'none';
        });

        // Smooth number formatting on blur
        input.addEventListener('blur', function() {
          if (this.value) {
            const value = parseFloat(this.value);
            if (!isNaN(value)) {
              // Add subtle animation when formatting
              this.style.transition = 'color 0.3s ease';
              this.style.color = 'var(--success-color)';
              setTimeout(() => {
                this.style.color = '';
              }, 500);
            }
          }
        });
      });

      // Add floating labels effect
      inputs.forEach(input => {
        const label = input.closest('.form-group').querySelector('label');
        
        input.addEventListener('focus', () => {
          label.style.transform = 'translateY(-2px)';
          label.style.color = 'var(--primary-color)';
        });
        
        input.addEventListener('blur', () => {
          label.style.transform = 'translateY(0)';
          label.style.color = 'var(--text-primary)';
        });
      });
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.key === 'Enter') {
        e.preventDefault();
        calculateTax();
      }
    });
  </script>
</body>
</html>
